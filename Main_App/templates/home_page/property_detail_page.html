<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ property.property_title|default:"Property Details" }} — TheProperty (Dark)</title>

  <!-- Bootstrap + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Optional: Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    /* ---------- THEME VARIABLES ---------- */
    :root{
      --bg-main: #07111a;
      --bg-surface: rgba(255,255,255,0.03);
      --muted: #94a3b8;
      --text: #e6f0fb;
      --primary: #5b8cff;
      --accent: #ffca4b;
      --glass-border: rgba(127,146,255,0.06);
      --radius: 14px;
      --card-shadow: 0 10px 30px rgba(10,15,30,0.6);
    }

    /* ---------- GLOBAL ---------- */
    html,body{ height:100%; margin:0; font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background: radial-gradient(1200px 600px at 10% 10%, rgba(91,140,255,0.03), transparent 8%), var(--bg-main); color:var(--text); -webkit-font-smoothing:antialiased;}
    a{ color:var(--primary); text-decoration:none; }
    a:hover{ color: #7fa6ff; }

    /* ---------- HEADER / SMART SEARCH ---------- */
    header.site-header{
      position:sticky; top:0; z-index:1050;
      backdrop-filter: blur(8px);
      background: linear-gradient(180deg, rgba(2,6,12,0.55), rgba(5,10,18,0.45));
      border-bottom:1px solid rgba(255,255,255,0.02);
      padding:12px 18px;
    }
    .header-inner{ max-width:1200px; margin:0 auto; display:flex; align-items:center; gap:16px; justify-content:space-between; }
    .brand { font-weight:800; font-size:1.35rem; letter-spacing:0.3px; background:linear-gradient(90deg,var(--accent), #ffd89b); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
    .nav-links{ display:flex; gap:14px; align-items:center; color:var(--muted); }
    .nav-links a{ color:var(--muted); font-weight:600; }
    .nav-links a.active{ color:var(--text); }

    /* smart search */
    .search-shell{
      display:flex; gap:8px; align-items:center;
      background:var(--bg-surface); border-radius:999px; padding:8px;
      border:1px solid var(--glass-border);
    }
    .search-shell .form-control{ background:transparent; border:0; color:var(--text); box-shadow:none; }
    .search-shell .form-control::placeholder{ color: rgba(230,240,255,0.35); }
    .search-shell .btn-search{ background:linear-gradient(90deg,var(--primary), #86a0ff); color:#07101a; font-weight:700; border-radius:999px; padding:10px 14px; border:0; }

    /* mobile nav toggle */
    .mobile-toggle{ display:none; background:transparent; border:0; color:var(--accent); font-size:1.2rem; }

    /* ---------- PAGE LAYOUT ---------- */
    .container-lg { max-width:1200px; padding:22px; margin:0 auto; }
    main.page-main{ padding-top:18px; padding-bottom:48px; }

    /* hero small */
    .page-crumb{ color:var(--muted); font-size:.95rem; margin-bottom:8px; }

    /* ---------- PROPERTY CARD / DETAILS ---------- */
    .card-glass{
      background:var(--bg-surface); border-radius:var(--radius); border:1px solid var(--glass-border);
      box-shadow: var(--card-shadow); color:var(--text);
    }

    /* gallery */
    .gallery-top{ border-radius:12px; overflow:hidden; position:relative; border:1px solid rgba(255,255,255,0.02); }
    .gallery-top img{ width:100%; height:420px; object-fit:cover; display:block;transition:transform .45s ease; }
    .gallery-top img:hover{ transform:scale(1.03); }

    /* thumbnails strip */
    .thumbs{ display:flex; gap:8px; margin-top:10px; }
    .thumbs img{ width:72px; height:54px; object-fit:cover; border-radius:8px; cursor:pointer; opacity:.9; border:1px solid rgba(255,255,255,0.03); }
    .thumbs img.active{ outline:2px solid var(--primary); opacity:1; transform:translateY(-3px); }

    /* info */
    .prop-title{ font-size:1.5rem; font-weight:800; margin:0; }
    .prop-sub{ color:var(--muted); font-size:.95rem; margin-top:4px; }

    .badges-row{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
    .badge-pill{ padding:6px 10px; border-radius:999px; font-weight:700; font-size:.82rem; background:linear-gradient(90deg,var(--primary), #86a0ff); color:#07101a; box-shadow:0 8px 30px rgba(79,115,255,0.06); }

    .meta-list{ display:flex; gap:14px; color:var(--muted); font-size:.92rem; margin-top:12px; flex-wrap:wrap; }

    /* sticky price footer on mobile */
    .mobile-price-cta{ display:none; position:fixed; left:12px; right:12px; bottom:18px; z-index:1200; border-radius:14px; padding:12px; justify-content:space-between; align-items:center; gap:12px; }
    .mobile-price-cta .price{ font-weight:900; font-size:1.05rem; color:#04101a; background:linear-gradient(90deg,var(--primary), #86a0ff); padding:8px 12px; border-radius:10px; }

    /* amenities */
    .amenity{ display:flex; align-items:center; gap:8px; padding:8px 10px; background:rgba(255,255,255,0.02); border-radius:10px; color:var(--muted); font-weight:600; font-size:.92rem; }

    /* agent card */
    .agent-card{ display:flex; gap:12px; align-items:center; padding:14px; border-radius:12px; background:var(--bg-surface); border:1px solid var(--glass-border); }
    .agent-avatar{ width:64px; height:64px; border-radius:999px; object-fit:cover; }

    /* inquiry */
    .inquiry .form-control{ background:#08121a; border:1px solid rgba(255,255,255,0.03); color:var(--text); }
    .inquiry .btn-primary{ background:linear-gradient(90deg,var(--primary), #86a0ff); border:0; color:#07101a; font-weight:800; }

    /* map */
    .map-frame{ width:100%; height:260px; border-radius:10px; border:1px solid rgba(255,255,255,0.03); overflow:hidden; }

    /* timesince badge (small) */
    .age-badge{ padding:6px 10px; border-radius:999px; font-weight:700; font-size:.82rem; background:rgba(255,255,255,0.02); color:var(--muted); border:1px solid rgba(255,255,255,0.03); }

    /* ---------- RESPONSIVE ---------- */
    @media (max-width: 991px){
      .thumbs img{ width:64px; height:48px; }
    }
    @media (max-width: 767px){
      .gallery-top img{ height:300px; }
      .mobile-toggle{ display:inline-block; }
      .nav-links{ display:none; }
      .search-shell{ width:100%; }
      .mobile-price-cta{ display:flex; transform:translateY(0); }
      .container-lg{ padding-left:14px; padding-right:14px; }
    }

    /* small helpers */
    .muted { color:var(--muted); }
    .text-small { font-size:.88rem; color:var(--muted); }
  </style>
</head>

<body>
  <!-- HEADER -->
  <header class="site-header">
    <div class="header-inner">
      <div class="d-flex align-items-center gap-3">
        <a href="{% url 'index' %}" class="brand">TheProperty</a>
        <div class="page-crumb d-none d-md-block muted">Rentals • Verified listings</div>
      </div>

      <!-- SMART SEARCH (keeps variables) -->
      <form action="" method="get" class="d-flex align-items-center" style="flex:1; max-width:760px;">
        <div class="search-shell w-100">
          <input name="q" class="form-control" placeholder="Search city, area, or landmark (e.g. Nagpur, Wakad, Koregaon)"/>
          <select name="segment" class="form-select w-auto" style="max-width:120px;">
            <option value="res" {% if request.GET.segment == 'res' %}selected{% endif %}>Res</option>
            <option value="com" {% if request.GET.segment == 'com' %}selected{% endif %}>Com</option>
            <option value="pg" {% if request.GET.segment == 'pg' %}selected{% endif %}>PG</option>
          </select>
          <button class="btn btn-search" type="submit"><i class="bi bi-search me-1"></i>Search</button>
        </div>
      </form>

      <div class="d-flex align-items-center gap-3">
        <nav class="nav-links">
          <a href="{% url 'index' %}">Home</a>
          <a href="{% url 'properties' %}" class="active">Properties</a>
          <a href="{% url 'services' %}">Services</a>
          <a href="{% url 'contact' %}">Contact</a>
        </nav>

        <button class="mobile-toggle" id="mobileToggle"><i class="bi bi-list"></i></button>
      </div>
    </div>

    <!-- mobile sliding nav -->
    <div id="mobileNav" class="bg-dark" style="display:none; position:fixed; top:64px; right:12px; width:260px; z-index:1100; border-radius:10px; padding:12px; border:1px solid rgba(255,255,255,0.03);">
      <a href="{% url 'index' %}" class="d-block py-2">Home</a>
      <a href="{% url 'properties' %}" class="d-block py-2">Properties</a>
      <a href="{% url 'services' %}" class="d-block py-2">Services</a>
      <a href="{% url 'contact' %}" class="d-block py-2">Contact</a>
    </div>
  </header>

  <!-- MAIN -->
  <main class="page-main">
    <div class="container-lg">
      <!-- breadcrumb / title -->
      <div class="mb-2 text-small">
        <a href="{% url 'index' %}" class="muted">Home</a> /
        <a href="{% url 'properties' %}" class="muted">Properties</a> /
        <span class="muted">{{ property.city }}</span>
      </div>

      <div class="row g-4">
        <!-- LEFT: Images + Details -->
        <div class="col-lg-8">
          <!-- Gallery -->
          <div class="card-glass p-3 mb-3">
            <!-- top row: badge + title + timesince -->
            <div class="d-flex justify-content-between align-items-start mb-2">
              <div>
                <h1 class="prop-title">{{ property.property_title|default:property.property_type }}</h1>
                <div class="prop-sub">{{ property.city }}{% if property.area %}, {{ property.area }}{% endif %} • {{ property.property_type|default:"Residential" }}</div>
                <div class="badges-row mt-2">
                  {% if property.is_verified %}<span class="badge-pill" title="Verified"><i class="bi bi-patch-check-fill me-1"></i>Verified</span>{% endif %}
                  {% if property.is_featured %}<span class="badge-pill" title="Featured"><i class="bi bi-star-fill me-1"></i>Featured</span>{% endif %}
                  {% if property.exclusive_property %}<span class="badge-pill" title="Exclusive"><i class="bi bi-gem me-1"></i>Exclusive</span>{% endif %}
                  <!-- age / newest -->
                  <div style="margin-left:6px;">
                    {% comment %} Age badge logic: uses property.created_at, 'today' and 'fifteen_days_ago' context variables. {% endcomment %}
                    {% if property.created_at.date == today %}
                      <span class="age-badge ms-1" style="background:linear-gradient(90deg,#2ecc71,#3cb878); color:#02120f;">Newest</span>
                    {% elif property.created_at.date >= fifteen_days_ago %}
                      <span class="age-badge ms-1" style="background:linear-gradient(90deg,#ffcc66,#ffaf3b); color:#241200;">Latest</span>
                    {% else %}
                      <span class="age-badge ms-1"><i class="bi bi-clock me-1"></i>{{ property.created_at|timesince }} ago</span>
                    {% endif %}
                  </div>
                </div>
              </div>

              <!-- desktop price block -->
              <div class="d-none d-md-flex flex-column align-items-end">
                <div class="badge-pill" style="background:linear-gradient(90deg,var(--accent), #ffd89b); color:#07101a; font-size:1.05rem;">₹{{ property.rent_price}}</div>
                <div class="text-small mt-1 muted">Deposit: ₹{{ property.security_deposit|default:"-" }}</div>
              </div>
            </div>

            <!-- image carousel (simple JS swap) -->
            <div class="gallery-top mb-2">
              {% comment %}
                If you have multiple images, pass them as property.images (iterable).
                The template gracefully falls back to property.property_images (single image).
              {% endcomment %}

              {% if property.images %}
                {% for img in property.images %}
                  <img src="{{ img.url }}" class="gallery-image {% if not forloop.first %}d-none{% endif %}" alt="{{ property.property_title }}">
                {% endfor %}
              {% elif property.property_images %}
                <img src="{{ property.property_images.url }}" class="gallery-image" alt="{{ property.property_title }}">
              {% else %}
                <img src="{% static 'assets/img/no-image.jpg' %}" class="gallery-image" alt="No image">
              {% endif %}
            </div>

            {% if property.images and property.images|length > 1 %}
              <div class="thumbs">
                {% for img in property.images %}
                  <img src="{{ img.url }}" class="thumb {% if forloop.first %}active{% endif %}" data-src="{{ forloop.counter0 }}">
                {% endfor %}
              </div>
            {% endif %}
          </div>

          <!-- BASIC INFO -->
          <div class="card-glass p-3 mb-3">
            <div class="row">
              <div class="col-md-8">
                <div class="meta-list">
                  <div><i class="bi bi-door-open me-1"></i> {{ property.bedrooms|default:"-" }} BHK</div>
                  <div><i class="bi bi-droplet me-1"></i> {{ property.bathrooms|default:"-" }} Baths</div>
                  <div><i class="bi bi-aspect-ratio me-1"></i> {{ property.builtup_area|default:"-"}} sqft</div>
                  {% if property.furnishing %}<div><i class="bi bi-box-seam me-1"></i> {{ property.furnishing }}</div>{% endif %}
                </div>

                <div class="mt-3">
                  <h5 class="mb-2">Overview</h5>
                  <p class="muted text-small">{{ property.short_description|default:property.description|truncatechars:220 }}</p>
                </div>
              </div>

              <div class="col-md-4 text-md-end d-none d-md-block">
                <div class="text-small muted">Available from</div>
                <div style="font-weight:800;">{{ property.available_from|default:"Immediate" }}</div>
                <div class="mt-3 text-small muted">Listed on</div>
                <div class="muted">{{ property.created_at|date:"M d, Y" }}</div>
              </div>
            </div>
          </div>

          <!-- DESCRIPTION -->
          {% if property.description %}
          <div class="card-glass p-3 mb-3">
            <h5>About this property</h5>
            <p class="muted text-small">{{ property.description }}</p>
          </div>
          {% endif %}

          <!-- AMENITIES -->
          {% if amenities %}
          <div class="card-glass p-3 mb-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h5 class="mb-0">Amenities</h5>
              <div class="text-small muted">{{ amenities|length }} items</div>
            </div>

            <div class="row g-2">
              {% for amenity in amenities %}
                <div class="col-6 col-md-4">
                  <div class="amenity">
                    <!-- simple mapping of some common names to icons (graceful fallback) -->
                    {% with name=amenity|lower %}
                      {% if "parking" in name %}
                        <i class="bi bi-car-front-fill" style="font-size:1.05rem;color:var(--primary)"></i>
                      {% elif "wifi" in name or "internet" in name %}
                        <i class="bi bi-wifi" style="font-size:1.05rem;color:var(--primary)"></i>
                      {% elif "ac" in name or "air" in name %}
                        <i class="bi bi-snow" style="font-size:1.05rem;color:var(--primary)"></i>
                      {% elif "lift" in name or "elevator" in name %}
                        <i class="bi bi-easel" style="font-size:1.05rem;color:var(--primary)"></i>
                      {% elif "power" in name or "backup" in name %}
                        <i class="bi bi-lightning-charge" style="font-size:1.05rem;color:var(--primary)"></i>
                      {% else %}
                        <i class="bi bi-check-circle" style="font-size:1.05rem;color:var(--primary)"></i>
                      {% endif %}
                    {% endwith %}
                    <div>{{ amenity }}</div>
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}

          <!-- LOCATION MAP -->
          {% if property.property_address %}
          <div class="card-glass p-3 mb-4">
            <h5 class="mb-2">Location</h5>
            <div class="map-frame">
              <iframe
                src="https://www.google.com/maps?q={{ property.property_address|urlencode }}&output=embed"
                width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
            </div>
          </div>
          {% endif %}
        </div>

        <!-- RIGHT: Sidebar (agent + inquiry + details) -->
        <div class="col-lg-4">
          <div class="d-flex flex-column gap-3">
            <!-- sticky container -->
            <div class="position-sticky" style="top:92px;">
              <!-- PRICE + ACTIONS -->
              <div class="card-glass p-3 mb-3">
                <div class="d-flex align-items-center justify-content-between mb-2">
                  <div>
                    <div class="text-small muted">Rent</div>
                    <div style="font-size:1.25rem; font-weight:900;">₹{{ property.rent_price }}</div>
                    <div class="text-small muted">/month • Deposit ₹{{ property.security_deposit|default:"-" }}</div>
                  </div>
                  <div>
                    {% comment %} show a small featured icon on the right if featured {% endcomment %}
                    {% if property.is_featured %}
                      <div class="badge-pill" style="background:linear-gradient(90deg,#ffd54a,#ffb86b);">Featured</div>
                    {% endif %}
                  </div>
                </div>

                <div class="d-grid gap-2">
                  <a href="tel:{{ property.agent.phone }}" class="btn btn-primary btn-lg"><i class="bi bi-telephone me-2"></i> Call Owner</a>
                  <a href="mailto:{{ property.agent.email }}" class="btn btn-outline-light btn-lg"><i class="bi bi-envelope me-2"></i> Message Owner</a>
                </div>

                <div class="mt-2 text-small muted">Listed {{ property.created_at|date:"M d, Y" }} • <span class="ms-1">{{ property.created_at|timesince }} ago</span></div>
              </div>

              <!-- AGENT -->
              {% if property.agent %}
              <div class="card-glass p-3 mb-3 agent-card">
                {% if property.agent.photo %}
                  <img src="{{ property.agent.photo.url }}" alt="{{ property.agent.name }}" class="agent-avatar">
                {% else %}
                  <div class="agent-avatar bg-dark d-flex align-items-center justify-content-center text-small muted" style="width:64px;height:64px;border-radius:999px;">No<br>Img</div>
                {% endif %}
                <div style="flex:1;">
                  <div style="font-weight:800;">{{ property.agent.name }}</div>
                  <div class="text-small muted">{{ property.agent.designation|default:"Owner / Agent" }}</div>
                  <div class="mt-2">
                    <small class="muted">Contact</small>
                    <div style="display:flex; gap:8px; align-items:center;">
                      <span id="agent-phone" class="text-small">*******</span>
                      <button class="btn btn-sm btn-outline-light" onclick="revealContact('{{ property.agent.phone|default:'' }}')">Show</button>
                    </div>
                  </div>
                </div>
              </div>
              {% endif %}

              <!-- QUICK DETAILS -->
              <div class="card-glass p-3 mb-3">
                <h6 class="mb-2">Quick Details</h6>
                <div class="text-small muted">
                  <div><strong>Built-up:</strong> {{ property.builtup_area|default:"-" }} sqft</div>
                  <div><strong>Floor:</strong> {{ property.floor_no|default:"-" }} / {{ property.total_floors|default:"-" }}</div>
                  <div><strong>Availability:</strong> {{ property.available_from|default:"Immediate" }}</div>
                  <div><strong>Furnishing:</strong> {{ property.furnishing|default:"Not specified" }}</div>
                  <div><strong>Posted:</strong> {{ property.created_at|date:"M d, Y" }}</div>
                </div>
              </div>

              <!-- INQUIRY FORM -->
              <div class="card-glass p-3 mb-3 inquiry">
                <h6>Send Inquiry</h6>
                <form method="post" action="">
                  {% csrf_token %}
                  <div class="mb-2">
                    <input class="form-control" name="name" placeholder="Your name" required>
                  </div>
                  <div class="mb-2">
                    <input type="email" class="form-control" name="email" placeholder="Email" required>
                  </div>
                  <div class="mb-2">
                    <input class="form-control" name="phone" placeholder="Phone" required>
                  </div>
                  <div class="mb-2">
                    <textarea class="form-control" name="message" rows="3" placeholder="Message (optional)"></textarea>
                  </div>
                  <div class="d-grid">
                    <button class="btn btn-primary" type="submit">Send Inquiry</button>
                  </div>
                </form>
              </div>

            </div> <!-- end sticky -->
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- MOBILE CTA (sticky bottom) -->
  <div class="mobile-price-cta card-glass d-md-none d-flex align-items-center">
    <div>
      <div class="text-small muted">Rent</div>
      <div class="price">₹{{ property.rent_price }}</div>
    </div>
    <div class="d-flex gap-2">
      <a href="tel:{{ property.agent.phone }}" class="btn btn-primary btn-sm"><i class="bi bi-telephone"></i></a>
      <a href="mailto:{{ property.agent.email }}" class="btn btn-outline-light btn-sm"><i class="bi bi-envelope"></i></a>
    </div>
  </div>

  <!-- FOOTER -->
  <footer style="padding:26px 0; margin-top:30px; border-top:1px solid rgba(255,255,255,0.02);">
    <div class="container-lg text-center text-small muted">
      <div style="margin-bottom:8px;">© {{ now|date:"Y" }} TheProperty — Verified rentals & trusted vendors</div>
      <div>
        <a href="" class="me-3">Terms</a>
        <a href="" class="me-3">Privacy</a>
        <a href="">Contact</a>
      </div>
    </div>
  </footer>

  <!-- SCRIPTS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Mobile nav toggle
    document.getElementById('mobileToggle').addEventListener('click', function(){
      const m = document.getElementById('mobileNav');
      m.style.display = (m.style.display === 'block') ? 'none' : 'block';
    });

    // Reveal agent phone (very small helper)
    function revealContact(phone){
      if(!phone){ alert('Phone not available'); return; }
      document.getElementById('agent-phone').innerText = phone;
    }

    // Simple gallery thumbnail switcher
    (function(){
      const thumbs = document.querySelectorAll('.thumbs img');
      const images = document.querySelectorAll('.gallery-image');

      if(!thumbs.length) return;

      thumbs.forEach((t, idx) => {
        t.addEventListener('click', function(){
          // set active thumb
          thumbs.forEach(x=>x.classList.remove('active'));
          t.classList.add('active');
          // switch images
          images.forEach((img,i)=>{
            img.classList.toggle('d-none', i !== idx);
          });
        });
      });
    })();
  </script>
</body>
</html>
