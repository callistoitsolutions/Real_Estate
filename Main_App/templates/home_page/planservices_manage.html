{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Manage Plan Services - {{ plan.name }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; }
    .service-row { display:flex; gap:10px; margin-bottom:10px; align-items:center; }
    select, input { flex:1; }
    .container-box {
      background:#fff;
      padding:30px;
      border-radius:12px;
      box-shadow:0 4px 10px rgba(0,0,0,0.1);
      max-width:900px;
      margin:auto;
    }
    .btn-add { background:#198754; color:white; border:none; border-radius:6px; padding:8px 15px; }
    .btn-remove { background:#dc3545; color:white; border:none; border-radius:6px; padding:6px 10px; }
  </style>
</head>
<body>
<div class="container py-5">
  <div class="container-box">
    <h3 class="text-center text-primary fw-bold mb-4">Manage Services for: {{ plan.name }}</h3>

    <form method="post">
      {% csrf_token %}
      <div id="rows">
        {% for ex in existing %}
          <div class="service-row">
            <select name="service_id[]" class="form-select">
              <option value="">-- Select Service --</option>
              {% for s in services %}
                <option value="{{ s.id }}" {% if s.id == ex.service.id %}selected{% endif %}>{{ s.title }}</option>
              {% endfor %}
            </select>

            <select name="duration[]" class="form-select">
              {% for dc in durations %}
                <option value="{{ dc.0 }}" {% if ex.duration == dc.0 %}selected{% endif %}>{{ dc.1 }}</option>
              {% endfor %}
            </select>

            <input type="number" step="0.01" name="price[]" class="form-control" value="{{ ex.price }}" placeholder="Price">
            <input type="number" step="0.01" name="discount[]" class="form-control" value="{{ ex.discount_percent }}" placeholder="Discount %">
            <button type="button" class="btn-remove" onclick="this.parentElement.remove()">Remove</button>
          </div>
        {% empty %}
          <p class="text-muted text-center">No services added yet.</p>
        {% endfor %}
      </div>

      <div class="text-center my-3">
        <button type="button" class="btn-add" onclick="addRow()">+ Add Service</button>
      </div>

      <div class="text-center mt-4">
        <button type="submit" class="btn btn-primary px-4 rounded-pill">Save Services</button>
        <a href="{% url 'plans_list' %}" class="btn btn-outline-secondary rounded-pill ms-2">Back to Plans</a>
      </div>
    </form>
  </div>
</div>

<script>
function addRow() {
  const services = `{% for s in services %}<option value="{{ s.id }}">{{ s.name }}</option>{% endfor %}`;
  const durations = `{% for dc in durations %}<option value="{{ dc.0 }}">{{ dc.1 }}</option>{% endfor %}`;
  const div = document.createElement('div');
  div.className = 'service-row';
  div.innerHTML = `
    <select name="service_id[]" class="form-select"><option value="">-- Select Service --</option>${services}</select>
    <select name="duration[]" class="form-select">${durations}</select>
    <input type="number" step="0.01" name="price[]" class="form-control" placeholder="Price">
    <input type="number" step="0.01" name="discount[]" class="form-control" placeholder="Discount %">
    <button type="button" class="btn-remove" onclick="this.parentElement.remove()">Remove</button>
  `;
  document.getElementById('rows').appendChild(div);
}
</script>
</body>
</html>
