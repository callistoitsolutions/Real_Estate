{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<style>
    body { background: #f4f5f7; font-family: 'Segoe UI', sans-serif; }
    .property-header { background: linear-gradient(145deg, #5a86ff, #003cb3); color: white; padding: 25px; border-radius: 10px; position: relative; }
    .property-header h2 { font-weight: bold; }
    .property-header .badge-featured { position: absolute; top: 20px; right: 20px; background: gold; color: black; font-weight: bold; padding: 8px 12px; border-radius: 5px; font-size: 0.9rem; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
    .carousel-inner img { max-height: 500px; object-fit: cover; border-radius: 10px; }
    .highlight-box, .amenities-box, .nearby-box, .map-box { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .section-title { font-weight: bold; font-size: 1.3rem; margin-bottom: 15px; color: #2c3e50; border-bottom: 2px solid #eee; padding-bottom: 5px; }
    .amenities-list li, .nearby-list li { display: inline-block; background: #e9ecef; padding: 6px 12px; margin: 5px; border-radius: 5px; font-size: 0.9rem; }
    .inquiry-card { border-radius: 10px; box-shadow: 0px 4px 12px rgba(0,0,0,0.15); background: white; }
    .blur-contact { filter: blur(4px); user-select: none; }
    .floating-btn { position: fixed; bottom: 30px; right: 30px; background: #ff5722; color: white; border-radius: 50%; padding: 15px 20px; font-size: 24px; box-shadow: 0px 4px 12px rgba(0,0,0,0.2); z-index: 1000; }
    .property-detail-label { font-weight: bold; color: #555; }
    .property-detail-value { color: #333; }
    .agent-card { border-radius: 10px; padding: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); background: white; }
</style>

<div class="container my-5">
    <!-- Property Header -->
    <div class="property-header mb-4">
        <h2>{{ property.property_title }}</h2>
        <p><i class="bi bi-geo-alt-fill"></i> {{ property.city }}, {{ property.area }}</p>
        <h3 class="fw-bold">₹{{ property.rent_price }} <small class="fs-6">/ month</small></h3>

        {% if property.is_featured %}
            <span class="badge-featured">FEATURED</span>
        {% endif %}
    </div>

    <!-- Property Carousel -->
    <div id="propertyCarousel" class="carousel slide mb-4" data-bs-ride="carousel">
        <div class="carousel-inner">
            {% if property.property_images %}
                <div class="carousel-item active">
                    <img src="{{ property.property_images.url }}" class="d-block w-100" alt="Property Image">
                </div>
            {% endif %}
            {% for img in property.images.all %}
                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                    <img src="{{ img.image.url }}" class="d-block w-100" alt="Property Image">
                </div>
            {% endfor %}
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#propertyCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#propertyCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
        </button>
    </div>

    <div class="row">
        <!-- Main Property Info -->
        <div class="col-md-8">
            <!-- Highlights -->
            <div class="highlight-box">
                <h4 class="section-title">Property Highlights</h4>
                <ul class="list-unstyled">
                    <li><i class="bi bi-house-fill"></i> Type: <span class="property-detail-value">{{ property.property_type }}</span></li>
                    <li><i class="bi bi-layout-text-sidebar-reverse"></i> Area: <span class="property-detail-value">{{ property.area }} sqft</span></li>
                    <li><i class="bi bi-door-open-fill"></i> Bedrooms: <span class="property-detail-value">{{ property.bedrooms }}</span></li>
                    <li><i class="bi bi-bath"></i> Bathrooms: <span class="property-detail-value">{{ property.bathrooms }}</span></li>
                    <li><i class="bi bi-furniture"></i> Furnishing: <span class="property-detail-value">{{ property.furnishing }}</span></li>
                    <li><i class="bi bi-check-circle"></i> Verified: <span class="property-detail-value">{{ property.is_verified }}</span></li>
                    {% if property.exclusive_property %}
                        <li><i class="bi bi-star-fill text-warning"></i> Exclusive Property</li>
                    {% endif %}
                    {% if property.brokerage_applicable %}
                        <li><i class="bi bi-currency-exchange"></i> Brokerage: {{ property.brokerage_value }} ({{ property.brokerage_type }})</li>
                    {% endif %}
                </ul>
            </div>

            <!-- Full Details -->
            <div class="highlight-box">
                <h4 class="section-title">Full Property Details</h4>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"><span class="property-detail-label">Address:</span> {{ property.property_address }}</li>
                    <li class="list-group-item"><span class="property-detail-label">Carpet Area:</span> {{ property.carpet_area }} sqft</li>
                    <li class="list-group-item"><span class="property-detail-label">Built-up Area:</span> {{ property.builtup_area }} sqft</li>
                    <li class="list-group-item"><span class="property-detail-label">Floor:</span> {{ property.floor_no }} / {{ property.total_floors }}</li>
                    <li class="list-group-item"><span class="property-detail-label">Security Deposit:</span> ₹{{ property.security_deposit }}</li>
                    <li class="list-group-item"><span class="property-detail-label">Maintenance:</span> ₹{{ property.maintenance }}</li>
                    <li class="list-group-item"><span class="property-detail-label">Description:</span> {{ property.description }}</li>
                </ul>
            </div>

            <!-- Amenities -->
            <div class="amenities-box">
                <h4 class="section-title">Amenities</h4>
                <ul class="amenities-list list-unstyled">
                    {% for amenity in property.amenities.all %}
                        <li><i class="bi bi-check-circle-fill text-success"></i> {{ amenity.name }}</li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Nearby Facilities -->
            <div class="nearby-box">
                <h4 class="section-title">Nearby Facilities</h4>
                <ul class="nearby-list list-unstyled">
                    {% for facility in property.nearby_facilities.all %}
                        <li><i class="bi bi-geo-alt-fill"></i> {{ facility.name }}</li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Map -->
            <div class="map-box">
                <h4 class="section-title">Location Map</h4>
                <iframe src="https://maps.google.com/maps?q={{ property.property_address }}&output=embed" width="100%" height="300" style="border:0;"></iframe>
            </div>
        </div>

        <!-- Inquiry Sidebar -->
        <div class="col-md-4">
            <div class="card inquiry-card p-4 mb-4">
                <h5 class="mb-3 text-center">Send Inquiry</h5>
                <form method="POST">
                    {% csrf_token %}
                    <input type="text" name="name" class="form-control mb-3" placeholder="Your Name" required>
                    <input type="email" name="email" class="form-control mb-3" placeholder="Your Email" required>
                    <input type="text" name="phone" class="form-control mb-3" placeholder="Your Phone" required>
                    <textarea name="message" class="form-control mb-3" rows="4" placeholder="Your Message" required></textarea>
                    <button type="submit" class="btn btn-primary w-100">Submit Inquiry</button>
                </form>
            </div>

            <!-- Agent Info -->
            <div class="agent-card">
                <div class="d-flex align-items-center">
                    <img src="{{ property.agent.image.url }}" alt="{{ property.agent.name }}" class="rounded-circle me-3" width="80" height="80">
                    <div>
                        <h5>{{ property.agent.name }}</h5>
                        <p class="small text-muted">{{ property.agent.title }}</p>
                        <p id="agent-phone" class="blur-contact"><i class="bi bi-telephone"></i> {{ property.agent.phone }}</p>
                        <button class="btn btn-sm btn-outline-primary" onclick="showAgentContact()">Show Contact</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<a href="tel:+911234567890" class="floating-btn"><i class="bi bi-telephone-fill"></i></a>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
function showAgentContact() {
    document.getElementById("agent-phone").classList.remove("blur-contact");
}
</script>
{% endblock %}
