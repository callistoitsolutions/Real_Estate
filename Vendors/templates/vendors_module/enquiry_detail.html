{% load static %}
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Enquiry {{ enquiry.enquiry_id }}</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
      body {
          background: #eef3ff;
          font-family: "Inter", sans-serif;
      }

      .page-title {
          font-weight: 700;
          color: #1f3c88;
      }

      .card-modern {
          background: #fff;
          padding: 25px;
          border-radius: 18px;
          box-shadow: 0 4px 20px rgba(0,0,0,0.08);
          margin-top: 20px;
      }

      .vendor-table thead {
          background: #1e3c72;
          background: linear-gradient(90deg, #1e3c72, #2a5298);
          color: #fff;
      }

      .vendor-table tbody tr:hover {
          background: rgba(0,0,0,0.04);
      }

      .back-btn {
          font-size: 15px;
          text-decoration: none;
      }

      .assign-box {
          border-left: 4px solid #1e88e5;
          padding-left: 15px;
      }
  </style>
</head>

<body class="p-4">
<div class="container">

  <!-- Back Button -->
  <a href="{% url 'admin_enquiry_list' %}" class="back-btn mb-3 d-inline-block text-primary">
      ‚Üê Back to Enquiries
  </a>

  <!-- Page Header -->
  <h2 class="page-title">
      Enquiry Details ‚Äî {{ enquiry.enquiry_id }}
  </h2>

  <!-- Enquiry Card -->
  <div class="card-modern mt-3">
      <h5 class="fw-bold mb-3">üìù Enquiry Information</h5>

      <p><strong>Service:</strong> {{ enquiry.service }}</p>
      <p><strong>City:</strong> {{ enquiry.city }}</p>
      <p><strong>Description:</strong></p>
      <div class="p-3 bg-light rounded">{{ enquiry.details|linebreaks }}</div>

      <p class="mt-3">
          <strong>Status:</strong>
          <span class="badge 
              {% if enquiry.status == 'shared' %} bg-warning text-dark
              {% elif enquiry.status == 'assigned' %} bg-primary
              {% elif enquiry.status == 'completed' %} bg-success
              {% else %} bg-secondary
              {% endif %}
          ">
              {{ enquiry.status|title }}
          </span>
      </p>
  </div>

  <!-- Matched Vendors -->
  <div class="card-modern mt-4">
      <h5 class="fw-bold mb-3">ü§ù Matched & Shared Vendors</h5>

      {% if shares %}
          <div class="table-responsive">
              <table class="table vendor-table table-borderless align-middle">
                  <thead>
                      <tr>
                          <th>Vendor Name</th>
                          <th>Responded</th>
                          <th>Accepted</th>
                      </tr>
                  </thead>
                  <tbody>
                      {% for share in shares %}
                      <tr>
                          <td>{{ share.vendor.business_name }}</td>

                          <td>
                              {% if share.responded %}
                                  <span class="badge bg-info">Yes</span>
                              {% else %}
                                  <span class="badge bg-secondary">No</span>
                              {% endif %}
                          </td>

                          <td>
                              {% if share.accepted %}
                                  <span class="badge bg-success">Accepted</span>
                              {% else %}
                                  <span class="badge bg-danger">Not Accepted</span>
                              {% endif %}
                          </td>
                      </tr>
                      {% endfor %}
                  </tbody>
              </table>
          </div>
      {% else %}
          <p class="text-muted">No matched vendors yet</p>
      {% endif %}
  </div>

  <!-- Manual Assign -->
  <div class="card-modern mt-4">
      <h5 class="fw-bold mb-3">üõ† Manual Vendor Assignment</h5>

      <p class="assign-box">
          Admin can manually assign an enquiry to any vendor.
      </p>

      <form method="post" action="{% url 'manual_assign_enquiry' enquiry.enquiry_id %}" class="mt-3">
          {% csrf_token %}

          <div class="mb-3">
              <label class="form-label"><strong>Select Vendor</strong></label>
              <input name="vendor_id" class="form-control" placeholder="Enter Vendor ID or choose from dropdown">
          </div>

          <button class="btn btn-primary w-100 py-2 fw-semibold">
              Assign Vendor
          </button>
      </form>
  </div>

</div>

</body>
</html>
