
{% block content %}
<div class="container py-4">
  <h3>Referral Monitor</h3>

  <form method="get" class="row g-2 mb-3">
    <div class="col-auto">
      <select class="form-select" name="status">
        <option value="">All Status</option>
        <option value="Pending">Pending</option>
        <option value="Approved">Approved</option>
        <option value="Rejected">Rejected</option>
      </select>
    </div>
    <div class="col-auto">
      <select name="rm_id" class="form-select">
        <option value="">All RMs</option>
        {% for rm in rms %}
          <option value="{{ rm.id }}">{{ rm.get_full_name|default:rm.username }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-auto">
      <input type="date" name="date_from" class="form-control">
    </div>
    <div class="col-auto">
      <input type="date" name="date_to" class="form-control">
    </div>
    <div class="col-auto">
      <button class="btn btn-primary" type="submit">Filter</button>
      <a href="?export=csv" class="btn btn-outline-secondary">Export CSV</a>
    </div>
  </form>

  <table class="table table-hover">
    <thead>
      <tr>
        <th>Referral ID</th><th>RM</th><th>Type</th><th>Referred</th><th>Status</th><th>Created</th><th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for r in referrals %}
      <tr>
        <td>REF{{ r.id }}</td>
        <td>{{ r.rm.get_full_name|default:r.rm.username }}</td>
        <td>{{ r.get_referral_type_display }}</td>
        <td>{{ r.referred_name }}<br><small>{{ r.referred_phone }}</small></td>
        <td>{{ r.status }}</td>
        <td>{{ r.created_at|date:"Y-m-d H:i" }}</td>
        <td>
          <a href="{% url 'referrals:superadmin_review' r.id %}" class="btn btn-sm btn-outline-primary">View</a>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="7">No referrals found.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
